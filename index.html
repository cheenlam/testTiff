<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>記錄使用者</title>
</head>
<body>
  <h2>資料上傳中，請稍候...</h2>

  <script>
    // 取得網址參數
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // Airtable 設定
    const AIRTABLE_API_KEY = 'patTEkO1RrWvVmfHX.d8fd89805159e18b7d24130cf2dfd41e08519826d1f1fa78ad27cdc5dfca0c05';
    const BASE_ID = 'appSNkPZK6WWQLIth';
    const TABLE_NAME = 'line_users';

    // 要寫入的資料
    const data = {
      fields: {
        userId: getQueryParam('userId') || '未知',
        displayName: getQueryParam('displayName') || '未知',
        agent: navigator.userAgent,
        createdAt: new Date().toISOString()
      }
    };

    // 發送到 Airtable
    fetch(`https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}`, {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${AIRTABLE_API_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(result => {
      console.log('成功寫入 Airtable:', result);
      document.body.innerHTML = '<h2>資料已成功記錄，謝謝！</h2>';
    })
    .catch(err => {
      console.error('Airtable 寫入失敗:', err);
      document.body.innerHTML = '<h2>資料寫入失敗，請稍後再試。</h2>';
    });
  </script>
</body>
</html>
